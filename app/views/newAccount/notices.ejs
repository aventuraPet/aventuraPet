<main>
    <%- include('../layout/msg'); -%>
    <div class="logo-container">
        <img src="/img/logo.png" alt="Aventura Pet Logo" class="logo">
        <h1 class="brand-title">Aventura Pet</h1>
        <p class="brand-subtitle">Crie sua conta e comece sua jornada com seu pet!</p>
    </div>
    <div class="form-container">
        <!-- Step 1: Name -->
        <div class="step" id="step1">
            <div class="progress-bar">
                <div class="progress" id="progress"></div>
            </div>
            <div class="step-icon">üë§</div>
            <h3>Qual √© seu nome?</h3>
            <p class="step-description">Vamos come√ßar conhecendo voc√™. Digite seu nome completo para personalizar sua experi√™ncia.</p>
            <input type="text" id="user_name" name="user_name" placeholder="Digite seu nome completo" required>
            <div class="error" id="nameError"></div>
            <button type="button" onclick="nextStep(1)">Seguinte</button>
        </div>
<script>
    document.addEventListener('DOMContentLoaded', function() {
        console.log(document.getElementById('user_name'));
    });
</script>
        <!-- Step 2: Email -->
        <div class="step" id="step2" style="display: none;">
            <div class="progress-bar">
                <div class="progress" id="progress"></div>
            </div>
            <button class="back-button" onclick="prevStep(2)">Voltar</button>
            <div class="step-icon">üìß</div>
            <h3>Qual √© seu email?</h3>
            <p class="step-description">Precisamos de um email v√°lido para criar sua conta e enviar notifica√ß√µes importantes.</p>
            <input type="email" id="email" name="email" placeholder="seuemail@exemplo.com" required>
            <div class="error" id="emailError"></div>
            <button type="button" onclick="nextStep(2)">Seguinte</button>
        </div>

        <!-- Step 3: Password -->
        <div class="step" id="step3" style="display: none;">
            <div class="progress-bar">
                <div class="progress" id="progress"></div>
            </div>
            <button class="back-button" onclick="prevStep(3)">Voltar</button>
            <div class="step-icon">üîí</div>
            <h3>Crie uma senha segura</h3>
            <p class="step-description">Sua senha deve ter pelo menos 8 caracteres, incluindo letras mai√∫sculas, min√∫sculas, n√∫meros e s√≠mbolos.</p>
            <input type="password" id="password" name="password" placeholder="Digite sua senha" required>
            <input type="password" id="confirmPassword" name="confirmPassword" placeholder="Repita sua senha" required>
            <div class="error" id="passwordError"></div>
            <button type="button" onclick="nextStep(3)">Seguinte</button>
        </div>

        <!-- Step 4: Phone -->
        <div class="step" id="step4" style="display: none;">
            <div class="progress-bar">
                <div class="progress" id="progress"></div>
            </div>
            <button class="back-button" onclick="prevStep(4)">Voltar</button>
            <div class="step-icon">üìû</div>
            <h3>Qual √© seu telefone?</h3>
            <p class="step-description">Precisamos de seu n√∫mero de telefone para contato e notifica√ß√µes.</p>
            <input type="tel" id="phone" name="phone" placeholder="(11) 99999-9999" required oninput="formatPhone(this)">
            <div class="error" id="phoneError"></div>
            <button type="button" onclick="nextStep(4)">Seguinte</button>
        </div>

        <!-- Step 5: CEP -->
        <div class="step" id="step5" style="display: none;">
            <div class="progress-bar">
                <div class="progress" id="progress"></div>
            </div>
            <button class="back-button" onclick="prevStep(5)">Voltar</button>
            <div class="step-icon">üè†</div>
            <h3>Qual √© seu CEP?</h3>
            <p class="step-description">Informe seu CEP para localiza√ß√£o e personaliza√ß√£o de servi√ßos.</p>
            <input type="text" id="cep" name="cep" placeholder="00000-000" required oninput="formatCEP(this)">
            <div class="error" id="cepError"></div>
            <button type="button" onclick="nextStep(5)">Seguinte</button>
        </div>

        <!-- Step 6: Pet Preference -->
        <div class="step" id="step6" style="display: none;">
            <div class="progress-bar">
                <div class="progress" id="progress"></div>
            </div>
            <button class="back-button" onclick="prevStep(6)">Voltar</button>
            <div class="step-icon">üêæ</div>
            <h3>O que voc√™ prefere?</h3>
            <p class="step-description">Conte-nos se voc√™ prefere cachorros ou gatos. Isso nos ajuda a personalizar sua experi√™ncia!</p>
            <form id="registrationForm" action="/new-account/create" method="post">
                <input type="hidden" name="user_name" id="hidden_user_name">
                <input type="hidden" name="email" id="hidden_email">
                <input type="hidden" name="password" id="hidden_password">
                <input type="hidden" name="phone" id="hidden_phone">
                <input type="hidden" name="cep" id="hidden_cep">
                <div class="radio-group">
                    <label class="pet-option">
                        <input type="radio" name="petPreference" value="cachorro" required>
                        <span class="pet-icon">üê∂</span>
                        <span class="pet-label">Cachorro</span>
                    </label>
                    <label class="pet-option">
                        <input type="radio" name="petPreference" value="gato" required>
                        <span class="pet-icon">üê±</span>
                        <span class="pet-label">Gato</span>
                    </label>
                </div>
                <div class="error" id="petError"></div>
                <button type="submit">Criar Conta</button>
            </form>
        </div>
    </div>
    <a style="text-decoration: none; color: #00376b;" href="/login">J√° tem conta?</a>
    <script>
        let currentStep = 1;
        const totalSteps = 6;

        function updateProgress() {
            const progress = document.getElementById('progress');
            progress.style.width = `${(currentStep / totalSteps) * 100}%`;
        }

        function nextStep(step) {
            if (validateStep(step)) {
                // Hide current step
                document.getElementById(`step${currentStep}`).style.display = 'none';
                currentStep++;
                // Show next step
                document.getElementById(`step${currentStep}`).style.display = 'block';
                updateProgress();
                // If moving to step 6, populate hidden fields
                if (currentStep === 6) {
                    document.getElementById('hidden_user_name').value = document.getElementById('user_name').value;
                    document.getElementById('hidden_email').value = document.getElementById('email').value;
                    document.getElementById('hidden_password').value = document.getElementById('password').value;
                    document.getElementById('hidden_phone').value = document.getElementById('phone').value;
                    document.getElementById('hidden_cep').value = document.getElementById('cep').value;
                }
            }
        }

        function prevStep(step) {
            // Hide current step
            document.getElementById(`step${currentStep}`).style.display = 'none';
            currentStep--;
            // Show previous step
            document.getElementById(`step${currentStep}`).style.display = 'block';
            updateProgress();
        }

        function validateStep(step) {
            let isValid = true;
            let errorDiv;

            if (step === 1) {
                errorDiv = document.getElementById('nameError');
                const name = document.getElementById('user_name').value;
                if (name.length < 4 || name.length > 100) {
                    errorDiv.textContent = 'Nome deve ter entre 4 e 100 caracteres.';
                    isValid = false;
                } else {
                    errorDiv.textContent = '';
                }
            } else if (step === 2) {
                errorDiv = document.getElementById('emailError');
                const email = document.getElementById('email').value.trim();
                const emailRegex = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
                if (!emailRegex.test(email)) {
                    errorDiv.textContent = 'Email inv√°lido.';
                    isValid = false;
                } else {
                    errorDiv.textContent = '';
                }
            } else if (step === 3) {
                errorDiv = document.getElementById('passwordError');
                const password = document.getElementById('password').value;
                const confirmPassword = document.getElementById('confirmPassword').value;
                if (password.length < 8 || !/(?=.*[a-z])(?=.*[A-Z])(?=.*\d)(?=.*[\W_])/.test(password)) {
                    errorDiv.textContent = 'Senha deve ter pelo menos 8 caracteres, incluindo mai√∫scula, min√∫scula, n√∫mero e s√≠mbolo.';
                    isValid = false;
                } else if (password !== confirmPassword) {
                    errorDiv.textContent = 'Senhas n√£o coincidem.';
                    isValid = false;
                } else {
                    errorDiv.textContent = '';
                }
            } else if (step === 4) {
                errorDiv = document.getElementById('phoneError');
                const phone = document.getElementById('phone').value.trim();
                const phoneRegex = /^\(\d{2}\)\s\d{5}-\d{4}$/;
                if (!phoneRegex.test(phone)) {
                    errorDiv.textContent = 'Telefone deve estar no formato (XX) XXXXX-XXXX.';
                    isValid = false;
                } else {
                    errorDiv.textContent = '';
                }
            } else if (step === 5) {
                errorDiv = document.getElementById('cepError');
                const cep = document.getElementById('cep').value.trim();
                const cepRegex = /^\d{5}-\d{3}$/;
                if (!cepRegex.test(cep)) {
                    errorDiv.textContent = 'CEP deve estar no formato XXXXX-XXX.';
                    isValid = false;
                } else {
                    errorDiv.textContent = '';
                }
            } else if (step === 6) {
                errorDiv = document.getElementById('petError');
                const petPreference = document.querySelector('input[name="petPreference"]:checked');
                if (!petPreference) {
                    errorDiv.textContent = 'Selecione uma prefer√™ncia de pet.';
                    isValid = false;
                } else {
                    errorDiv.textContent = '';
                }
            }

            return isValid;
        }

        document.getElementById('registrationForm').addEventListener('submit', function(e) {
            if (!validateStep(6)) {
                e.preventDefault();
            }
            // If validation passes, let the form submit normally
        });

        // Initialize
        updateProgress();

        function formatPhone(input) {
            let value = input.value.replace(/\D/g, '');
            if (value.length <= 11) {
                value = value.replace(/(\d{2})(\d{5})(\d{4})/, '($1) $2-$3');
                input.value = value;
            }
        }

        function formatCEP(input) {
            let value = input.value.replace(/\D/g, '');
            if (value.length <= 8) {
                value = value.replace(/(\d{5})(\d{3})/, '$1-$2');
                input.value = value;
            }
        }
    </script>
</main>
